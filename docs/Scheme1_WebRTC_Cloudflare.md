# 方案一：WebRTC + Cloudflare (透明 P2P 模式)

### 1. 核心架构
这种方案利用 Cloudflare 部署网页和信令服务器，但实际的数据传输通过 WebRTC 在浏览器之间点对点完成。

- **信令服务器 (Cloudflare Worker)**：仅用于交换双方的通信“入场券”（SDP 和 ICE Candidates）。不接触任何文件数据。
- **主机 (Room Host)**：第一个进入房间的人，其浏览器内存负责维护该房间的消息历史。
- **数据通道 (Data Channel)**：建立 P2P 连接后，文件和文本直接在两台设备间传输，不经过云端。

### 2. 实现逻辑

#### A. 房间建立
1. 用户 A 访问 Web 页面，输入 `888`。
2. 发现房间不存在，用户 A 自动成为 **Host**。
3. 用户 A 在自己的浏览器 `IndexedDB` 中初始化一个空的 `History` 表。

#### B. 数据持有
- **文本数据**：用户 B 发送文本，先发给 Host，Host 保存并分发。
- **文件数据**：用户 B 选取文件，仅向 Host 发送文件元数据（文件名、大小、MimeType）。
- **文件流**：文件字节仍然留在用户 B 的浏览器 `Blob` 缓存中，不进行物理上传。

#### C. 点对点传输 (WebRTC)
1. 用户 C 点击历史记录中的“下载”。
2. 系统通过信令告知用户 B：“用户 C 请求下载文件 ID_123”。
3. 用户 B 与 用户 C 建立 **P2P Data Channel**。
4. 用户 B 将文件切片，像流一样通过 WebRTC 直接推给用户 C。

### 3. 优缺点
- **优点**：无需安装，适配 iOS/Android/PC；数据不离内网，私密性极高；不限文件大小。
- **缺点**：WebRTC 建立连接受 NAT 类型影响，极端复杂网络下可能需要经过 TURN 服务器中转（会变慢）。

---
